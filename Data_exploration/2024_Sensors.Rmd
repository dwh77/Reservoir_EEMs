---
title: "CCR spatial CTD and YSI measurements"
author: "Dexter Howard"
date: "2024-05-30"
output: html_document
---

## Read in packages 

```{r, include = F}
library(tidyverse)
library(ggpubr)
library(colorRamps) #for heatmap
library(RColorBrewer) #for heatmap 
library(rLakeAnalyzer)
# library(scales) #for date format on plots
# library(patchwork) #arrange figures w/ slashes and lines
# library(plotly)
# library(viridis)

```


## Temp/Cond across sites

Get YSI data 

```{r}
## YSI data
# ysi_gsheet <- gsheet::gsheet2tbl("https://docs.google.com/spreadsheets/d/1HbSBEFjMuK4Lxit5MRbATeiyljVAB-cpUNxO3dKd8V8/edit#gid=1787819257")

ysi_L1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/YSI_PAR/ysi_L1.csv")

ccr_ysi <- ysi_L1 |>
  filter(Reservoir == "CCR") |>
  mutate(Date = as.Date(DateTime)) |>
  filter(year(Date) > 2023,
         !Date %in% c(ymd("2024-07-31"), ymd("2024-08-01")))

```


CTD cleaning function 

```{r}
###function to clean ctd casts
ccr_ctd_clean <- function(data){

  #slice by depth for each reservoir
    depths = seq(0.1, 23, by = 0.5)
    df.final<-data.frame()

 for (i in 1:length(depths)){
      
      fp_layer <- data %>% 
        mutate(Date = as.Date(DateTime)) |> 
        group_by(Date, Site) |>  
        slice(which.min(abs(as.numeric(Depth_m) - depths[i])))
      
      # Bind each of the data layers together.
      df.final = bind_rows(df.final, fp_layer)%>%
      mutate(Depth_m = round(Depth_m, digits = 1)) |> 
       dplyr::distinct() 
 }
    return(df.final)
}

```


Get CTD Data

```{r}
### read in raw data 
ctd_L1 <- read_csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/Raw_CTD/ctd_L1.csv")

ccr_ctd_24 <- ctd_L1 |> 
  mutate(Date = as.Date(DateTime)) |> 
  select(Reservoir, Site, Date, everything()) |> 
  filter(Reservoir == "CCR") 

ccr_ctd_24 <- ccr_ctd_clean(ccr_ctd_24)


```


CTD check plots 

```{r}
#plot 4 focal variables and remove known bad points

ccr_ctd_24 |> 
  filter(Chla_ugL < 50) |> #remove crazy high chla at site 90 (likely sensor in mud)
  mutate(SpCond_uScm = ifelse(Date == ymd("2024-06-19") & SpCond_uScm < 110, NA, SpCond_uScm )) |> #remove Cond bubble issues that should get worked out at some point
  pivot_longer(-c(1:6)) |> 
  filter(name %in% c("Temp_C", "SpCond_uScm", "DO_mgL", "Chla_ugL", "CDOM_ugL")) |> 
  # filter(Site == 50) |> 
  ggplot(aes(x = value, y = Depth_m, color = as.factor(Date)))+
  geom_line(orientation = "y")+
  scale_y_reverse()+
  facet_grid(Site~name, scales = "free")+
  theme_bw()

```

## CCR ADCP plots 

```{r}
#all sites
ccr_ctd_24 |> 
  filter(Date == ymd("2024-08-15")) |> 
  filter(Turbidity_NTU < 50) |> 
  select(Site, Depth_m, Temp_C, DOsat_percent, SpCond_uScm, Chla_ugL, Turbidity_NTU, CDOM_ugL) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = value, y = Depth_m))+
  geom_line(orientation = "y")+  scale_y_reverse()+
  facet_grid(Site~name, scales = "free")+  theme_bw()+ theme(text = element_text(size = 18))

#C3
ccr_ctd_24 |> 
  filter(Date == ymd("2024-08-15"), Site == 90) |> 
  filter(Turbidity_NTU < 50) |> 
  select(Site, Depth_m, Temp_C, SpCond_uScm, Turbidity_NTU, CDOM_ugL) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = value, y = Depth_m))+
  geom_line(orientation = "y")+  scale_y_reverse()+
  facet_grid(Site~name, scales = "free")+  theme_bw()+ theme(text = element_text(size = 18))


```



## Bring CTD to YSI

```{r}
## grab distances to bind in 
distances <- read.csv("C:/Users/dwh18/Downloads/2024 spatial sampling - Distances.csv") |> 
  mutate(Date = mdy(Date)) |> 
  select(-c(13,14)) |> 
  pivot_longer(-c(1,11,12), names_to = "Site_code", values_to = "Distance_ft")


##bind data together
ctd_bind <- ccr_ctd_24 |> 
  select(Reservoir, Site, Date, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
  filter(!Date %in% c(ymd("2024-07-31"), ymd("2024-08-01"), ymd("2024-08-15"))) |>  #non EEM sample days
  mutate(SpCond_uScm = ifelse(SpCond_uScm < 100, NA, SpCond_uScm)  ) # remove low values that aren't realistic

ysi_bind <- ccr_ysi |> 
  select(Reservoir, Site, Date, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
  filter(!Site %in% c(88,90))

sensors_nodistance <- rbind(ctd_bind, ysi_bind) |> 
  # mutate(Distance_ft = ifelse(Site == 101, 0, NA),
  #        Distance_ft = ifelse(Site == 100, 407, Distance_ft),
  #        Distance_ft = ifelse(Site == 98, 619, Distance_ft),
  #        Distance_ft = ifelse(Site == 96, 790, Distance_ft),
  #        Distance_ft = ifelse(Site == 94, 1015, Distance_ft),
  #        Distance_ft = ifelse(Site == 92, 1132, Distance_ft),
  #        Distance_ft = ifelse(Site == 90, 1843, Distance_ft),
  #        Distance_ft = ifelse(Site == 88, 3326, Distance_ft),
  #        Distance_ft = ifelse(Site == 50, 5011, Distance_ft)
  #        ) |> 
  mutate(Site_code = ifelse(Site == 101, "S1", NA),
         Site_code = ifelse(Site == 100, "S2", Site_code),
         Site_code = ifelse(Site == 98, "P1", Site_code),
         Site_code = ifelse(Site == 96, "P2", Site_code),
         Site_code = ifelse(Site == 94, "C1", Site_code),
         Site_code = ifelse(Site == 92, "C2", Site_code),
         Site_code = ifelse(Site == 90, "C3", Site_code),
         Site_code = ifelse(Site == 88, "C4", Site_code),
         Site_code = ifelse(Site == 50, "50", Site_code)
         ) |> 
  select(Reservoir, Site, Site_code, Date, Depth_m, everything())


sensors <- left_join(sensors_nodistance, distances, by = c("Site_code", "Date")) |> 
    mutate(Distance = Distance_ft*0.3048,
         Dry_start = Dry_start*0.3048,
         Dry_end = Dry_end*0.3048) |> 
  select(Reservoir, Site, Site_code, Date, Distance, Dry_start, Dry_end, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm ) |> 
  filter(Site != 50, #remove site 50 for EEMs comp
         Date > ymd("2024-04-23")) # remove S1 measurement from before sampling


```


## Dot plots - old style

```{r}

##previous style plot
levels_sites <- c(101, 100, 98, 96, 94, 92, 90, 88, 50)
levels_sites_code <- c("S1", "S2", "P1", "P2", "C1", "C2", "C3", "C4", "50")

#Variable on Y
sensors |> 
  select(-DO_mgL) |> 
  pivot_longer(-c(1:8)) |> 
  mutate(Depth_m = ifelse(Depth_m == 1.1, 1, Depth_m),
         Depth_m = ifelse(Depth_m == 0.4, 0.5, Depth_m)) |> #just to make color gradient a lil cleaner
  #filter(Site > 50) |> #trim site 50 to help w/ viz
  #ggplot(aes(x = factor(Site, level = levels_sites), y = value, color = as.factor(Depth_m)))+
  ggplot(aes(x = factor(Site_code, levels = levels_sites_code), y = value, color = as.factor(Depth_m)))+
  geom_point(size = 3)+
  #facet_wrap(~name, nrow = 3, scales = "free_y")+
  facet_grid(name~Date, scales = "free_y")+
  # labs(title = "HPB", y = "Temp (C)", x = "Site")+
  theme_bw()+ theme(legend.position = "top", text = element_text(size = 18))+
  guides(color = guide_legend(nrow=2, byrow=TRUE))
  #scale_color_gradient("Depth_m",  high = "red", low = "blue") 
  

#Depth on Y
tempplot <- sensors |> 
  select(1:8, Temp_C) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = factor(Site_code, levels = levels_sites_code), y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

condplot <- sensors |> 
  select(1:8, SpCond_uScm) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = factor(Site_code, levels = levels_sites_code), y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "black", low = "#CFCFCF") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

doplot <- sensors |> 
  select(1:8, DOsat_percent) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = factor(Site_code, levels = levels_sites_code), y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "blue", low = "red") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

ggarrange(tempplot , condplot , doplot, ncol = 1)


```

Distance on x 

```{r}
#Depth on Y
tempplot <- sensors |> 
  select(1:8, Temp_C) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = 10, ymax = 12), 
            alpha = 0.1, fill = "blue" )+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

condplot <- sensors |> 
  select(1:8, SpCond_uScm) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
    geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = 10, ymax = 12), 
            alpha = 0.1, fill = "blue" )+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "black", low = "#CFCFCF") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

doplot <- sensors |> 
  select(1:8, DOsat_percent) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = 10, ymax = 12), 
            alpha = 0.1, fill = "blue" )+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "blue", low = "red") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

ggarrange(tempplot , condplot , doplot, ncol = 1)


### flipping so value is on y and color is depth
sensors |> 
  select(-DO_mgL) |> 
  pivot_longer(-c(1:8)) |> 
  ggplot(aes(x = Distance, y = value, color = Depth_m))+
  geom_point()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = 10, ymax = 12), 
            alpha = 0.1, fill = "blue" )+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "top", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "black", low = "#CFCFCF", , breaks = c(3,6,9,12)) # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

```





## Heatmaps 

```{r}

fp_new <- sensors |> 
  filter(Date == ymd("2024-05-22")) |> 
  mutate(Distance = Distance_ft*0.3048) |> 
   filter(Site < 100)

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = (Distance_ft*0.3048), y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ #to mark cast sites 
    scale_fill_gradientn(colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Temp CCR 22may24")+
    theme_bw()
  
  
#Cond
#   interp_spcond <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
#                    xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
#                    yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.5),
#                    extrap = T, linear = T, duplicate = "strip")
#   interp_spcond <- akima::interp2xyz(interp_spcond, data.frame=T)
#   
#   # max_depths <- fp_new |> 
#   #   group_by(Site, Distance) |> 
#   #   summarise(max_depth = max(Depth_m))
#   
#   # interp_spcond_v2 <- interp_spcond |> 
#   #   mutate(x_2 = ifelse(x < ))
#   
# ggplot(interp_spcond, aes(x=x, y=y))+
#     geom_raster(aes(fill=z))+
#     scale_y_reverse(expand = c(0,0))+
#     scale_x_continuous(expand = c(0, 0)) +
#     # geom_point(data = sensor_22may24, aes(x = (Distance_ft*0.3048), y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ #to mark cast sites ; (sensor_22may24 |> filter(!Site ==50))
#     scale_fill_gradientn(colours = colorRamps::blue2green2red(60), na.value="gray")+
#     labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Sp.Cond CCR 22may24")+
#     theme_bw()
# 
# fp_new
# ggplot(fp_new, aes(x = Distance, y = Depth_m)) +
#   geom_contour_filled(aes(z = Temp_C), bins = 5) +
#   scale_fill_brewer(palette = "Spectral") +
#   labs(x = "distance", y = "Depth (m)", fill = "Temperature (°C)") +
#   theme_minimal() + 
#   scale_y_reverse()


```


## CCR MSN Plots 

Get data 
```{r}
#YSI 
## midnight time for Site 90 has become the wrong day in L1 file
ysi_L1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/YSI_PAR/ysi_L1.csv")

ccr_ysi_MSN <- ysi_L1 |>
  filter(Reservoir == "CCR") |>
  mutate(Date = as.Date(DateTime)) |>
  filter(year(Date) > 2023,
         Date %in% c(ymd("2024-07-31"), ymd("2024-08-01"))) |> 
  mutate(DateTime = ymd_hms(DateTime)) |> 
  filter(Site %in% c(90,92)) |> 
  mutate(sensor = "YSI") |> 
  select(Site, DateTime, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm, sensor) 


#CTD
ctd_L1 <- read_csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/Raw_CTD/ctd_L1.csv")

ccr_ctd_clean_MSN <- function(data){

  #slice by depth for each reservoir
    depths = seq(0.1, 23, by = 0.1)
    df.final<-data.frame()

 for (i in 1:length(depths)){
      
      fp_layer <- data %>% 
        # mutate(Date = as.Date(DateTime)) |> 
        group_by(DateTime, Site) |>  
        slice(which.min(abs(as.numeric(Depth_m) - depths[i])))
      
      # Bind each of the data layers together.
      df.final = bind_rows(df.final, fp_layer)%>%
      mutate(Depth_m = round(Depth_m, digits = 1)) |> 
       dplyr::distinct() 
 }
    return(df.final)
}

ccr_ctd_MSN <- ctd_L1 |>
  filter(Reservoir == "CCR") |>
  mutate(Date = as.Date(DateTime)) |>
  filter(Date %in% c(ymd("2024-07-31"), ymd("2024-08-01")))  

ccr_ctd_MSN <- ccr_ctd_clean_MSN(ccr_ctd_MSN) |> 
    select(Site, DateTime, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
    mutate(sensor = "CTD")  

##full ctd check
ccr_ctd_MSN |> 
  ggplot(aes(x = Temp_C, y = Depth_m, color = as.factor(DateTime))) + 
  geom_line(orientation = 'y', size = 1.2)+
  scale_y_reverse()+
  facet_wrap(~Site, scales = "free")



## Put data together
ccr_MSN_profiles <- rbind(ccr_ysi_MSN, ccr_ctd_MSN)


```


Plotting 
```{r}
####### Get data together 

ccr_MSN_grouped <- ccr_MSN_profiles |> 
  mutate(DateTime = ymd_hms(DateTime),
         Hour = hour(DateTime),
         Date = as.Date(DateTime)) |> 
    # mutate(Hour_group = ifelse(Hour %in% c(23,0), 0, NA),
  #        Hour_group = ifelse(Hour %in% c(12,13), 12, Hour_group),
  #        Hour_group = ifelse(Hour %in% c(20,21), 8, Hour_group),
  #        Hour_group = ifelse(Hour %in% c(6), 6, Hour_group)
  #        ) |> 
  #mutate(DateTime_fixed = ifelse(Date == ymd("2024-07-31") & Hour_group == 0, DateTime + 1000, DateTime) ) |> 
  #mutate(DateTime_fixed = as.POSIXct(DateTime_fixed, tz = "UTC")) |>  #this and previous mutate: manually force times  right before midnight to shift past midnight for faceting
  ## mutate(SunTime = ifelse(Hour %in% c(23,0), "Midnight", NA),
  ##        SunTime = ifelse(Hour %in% c(12,13), "Noon", SunTime),
  ##       SunTime = ifelse(Hour %in% c(20,21), "Sunset", SunTime),
  ##        SunTime = ifelse(Hour %in% c(6), "Sunrise", SunTime)
  ##        ) |>
  mutate(SunTime = ifelse(DateTime > ymd_hm("2024-07-31 12:00") & DateTime < ymd_hm("2024-07-31 14:00") , 
                          "Noon 1", NA),
         SunTime = ifelse(DateTime > ymd_hm("2024-07-31 20:00") & DateTime < ymd_hm("2024-07-31 22:00") , 
                          "Sunset", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-07-31 23:00") & DateTime < ymd_hm("2024-08-01 2:00") , 
                          "Midnight", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-08-01 6:00") & DateTime < ymd_hm("2024-08-01 8:00") , 
                          "Sunrise", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-08-01 12:00") & DateTime < ymd_hm("2024-08-01 14:00") , 
                          "Noon 2", SunTime)
         ) |>
  filter(!(sensor == "YSI" & Site == 90)) |>
  # mutate(DateTime_new = ymd_h(paste(as.Date(DateTime_fixed), Hour_group, sep = " "))) |> 
  mutate(Distance_ft = ifelse(Site == 92, 1132, NA),
         Distance_ft = ifelse(Site == 90, 1843, Distance_ft),
         Distance_ft = ifelse(Site == 88, 3326, Distance_ft),
         Distance = Distance_ft*0.3048) 
  

####### site 92 
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 92) |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C2")


####### site 90
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 90,
         sensor == "CTD") |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C3")

# ccr_MSN_grouped |> 
#   select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
#   filter(Site == 90,
#          sensor == "YSI") |> 
#   pivot_longer(-c(1:4)) |> 
#   ggplot(aes(x = value, y = Depth_m, color = SunTime))+
#   facet_wrap(~name, scales = "free_x")+
#   geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
#   scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C3")


####### site 88
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 88) |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C4")
 


###### all sites 

time_levels <- c("Noon 1", "Sunset", "Midnight", "Sunrise", "Noon 2")

### flipping so value is on y and color is depth
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  ggplot(aes(x = Distance, y = value, color = Depth_m))+
  geom_point()+
  facet_grid(name~factor(SunTime, levels = time_levels), scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "blue", low = "red") 

#depth on y 
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(name~factor(SunTime, levels = time_levels), scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "black", low = "#CFCFCF")  # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"


## Lines instead of heatmpas
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  filter(Site == 90 ) |> 
  ggplot(aes(x = DateTime, y = value, color = as.factor(Depth_m)))+
  geom_point()+
  geom_line()+
  # facet_wrap(~Site, scales = "free_y", ncol =1 )+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))


#other 
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C) |> 
  #filter( SunTime == "Sunrise") |> 
  ggplot(aes(x = Temp_C, y = Depth_m))+
  facet_grid(factor(SunTime, levels = time_levels)~Site, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18), legend.position = "top")



```

Density Diffs 

```{r}
ccr_MSN_grouped

time_levels <- c("Noon 1", "Sunset", "Midnight", "Sunrise", "Noon 2")


dens_diff_data <- ccr_MSN_grouped |> 
  select(Site, SunTime, Depth_m, Temp_C) |> 
  group_by(Site, SunTime) |> 
  mutate(top_depth = min(Depth_m),
         bot_depth = max(Depth_m)) |> 
  mutate(wtr_top = ifelse(Depth_m == top_depth, Temp_C, NA),
         wtr_top = max(wtr_top, na.rm = T),
         wtr_bot = ifelse(Depth_m == bot_depth, Temp_C, NA),
         wtr_bot = max(wtr_bot, na.rm = T)) |> 
  mutate(temp_diff = wtr_top - wtr_bot,
            dens_diff = water.density(wtr_bot) - water.density(wtr_top)) |> 
  select(Site, SunTime, wtr_top, wtr_bot, temp_diff, dens_diff) |> 
  distinct()

dens_diff_data |> 
  select(Site, SunTime, temp_diff, dens_diff) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = factor(SunTime, levels = time_levels), y = value))+
  geom_point()+
  geom_hline(yintercept = 0)+
  geom_hline(yintercept = 0.1)+
  geom_hline(yintercept = 1)+
  facet_grid(name~Site, scales = "free_y")+
  labs(x = element_blank())+
  theme_bw() + theme(text = element_text(size = 18), axis.text.x = element_text(angle = 45, vjust = 0.5))




```

Heatmaps Time 

```{r}
#### C4
fp_new <- ccr_MSN_grouped |> 
  filter(Site == 88) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$DateTime), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$DateTime), max(fp_new$DateTime), by = 5000),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)
  interp_temp$DateTime <- as.POSIXct(interp_temp$x, tz = "UTC")

ggplot(interp_temp, aes(x=DateTime, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    geom_point(data = fp_new, aes(x = DateTime, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR C4")+
    theme_bw()


#### C3
fp_new <- ccr_MSN_grouped |> 
  filter(Site == 90) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$DateTime), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$DateTime), max(fp_new$DateTime), by = 5000),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m)*2, by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)
  interp_temp$DateTime <- as.POSIXct(interp_temp$x, tz = "UTC")

ggplot(interp_temp, aes(x=DateTime, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    geom_point(data = fp_new, aes(x = DateTime, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR C3")+
    theme_bw()





```



Heatmaps Distance

```{r}

#### Noon 1
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 1') 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon1 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Noon")+
    theme_bw()


#### Sunset
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunset') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunset <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Sunset")+
    theme_bw()

#### Midnight
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Midnight') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

midnight <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 1Aug - Midnight")+
    theme_bw()

#### Sunrise
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunrise') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunrise <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 1Aug - Sunrise")+
    theme_bw()

#### Noon 2
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 2') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon2 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Temp CCR 1Aug - Noon")+
    theme_bw()


### plots 
noon1
sunset
midnight
sunrise
noon2

library(patchwork)
noon1/sunset/midnight/sunrise/noon2


```

Cond heatmaps 
```{r}
#### Noon 1
fp_new <- ccr_MSN_grouped |>   filter(SunTime == 'Noon 1', !is.na(SpCond_uScm)) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10), yo = seq(min(fp_new$Depth_m),max(fp_new$Depth_m), by = 0.1), extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon1 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Noon")+
    theme_bw()


#### Sunset
fp_new <- ccr_MSN_grouped |>   filter(SunTime == 'Sunset') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1), extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunset <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+ scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 31July - Sunset")+
    theme_bw()

#### Midnight
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Midnight') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),         extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

midnight <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Midnight")+
    theme_bw()

#### Sunrise
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunrise') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunrise <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Sunrise")+
    theme_bw()

#### Noon 2
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 2') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),                 extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon2 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Noon")+
    theme_bw()


### plots 
noon1
sunset
midnight
sunrise
noon2

library(patchwork)
noon1/sunset/midnight/sunrise/noon2

```



## Pool and Cove HOBO buoys 

P1 
get data together from April - July 11
```{r}
hobo_P1_top <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo101_P1_top_11jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.25)

hobo_P1_mid <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo51_P1_mid_11jul24.csv", skip = 1) |> 
    select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.5)


hobo_P1_bot <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo36_P1_bot_11jul24.csv", skip = 1) |> 
    select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.75)


hobos_P1 <- rbind(hobo_P1_top, hobo_P1_mid, hobo_P1_bot) |> 
  mutate(DateTime = mdy_hms(DateTime))


```


P2
get data together from April - July 19
```{r}
hobo_P2_b1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo23_P2_BOT1_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1.5)

hobo_P2_b2 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo40_P2_bot2_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1.25)

hobo_P2_b3 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo44_P2_bot3_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1)

hobo_P2_b4 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo2_P2_bot4_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.75)

hobo_P2_b5 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo9_p2_bot5_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.5)

hobo_P2_b7 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo16_p2_bot7_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.1)

hobos_P2 <- rbind(hobo_P2_b1, hobo_P2_b2, hobo_P2_b3, hobo_P2_b4, hobo_P2_b5, hobo_P2_b7) |> 
  mutate(DateTime = mdy_hms(DateTime))


```


C2
get data together from April - July 19
```{r}
hobo_C2_b6 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo10_C2_bot6_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.75)

hobo_C2_b7 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo13_C2_bot7_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.5)

hobo_C2_b2 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo168_C2_BOt2_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.75)

hobo_C2_b3 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo19_C2_BOt3_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.5)

hobo_C2_b8 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo30_C2_bot8_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.25)

hobo_C2_b5 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo31_C2_bot5_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1)

hobo_C2_b1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo39_C2_BOT1_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 2)

hobo_C2_b9 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo63_C2_bot9_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.1)

hobo_C2_b4 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo68_C2_BOt4_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.25)


hobos_C2 <- rbind(hobo_C2_b1, hobo_C2_b2, hobo_C2_b3, hobo_C2_b4, hobo_C2_b5, 
                  hobo_C2_b6, hobo_C2_b7, hobo_C2_b8, hobo_C2_b9) |> 
  mutate(DateTime = mdy_hms(DateTime))

```


Density difference plots 

```{r}
head(hobos_C2)

## July subset
hobos_C2 |> 
  filter(DateTime > ymd("2024-07-15")) |> 
  mutate(Depth = paste0("wtr_", Depth)) |> 
  pivot_wider(names_from = Depth, values_from = Temp_C) |> 
  select(DateTime, wtr_0.1, wtr_2) |> 
  mutate(wtr_0.1_dens = water.density(wtr_0.1),
         wtr_2_dens = water.density(wtr_2),
         Dens_diff = wtr_2_dens - wtr_0.1_dens,
         Temp_diff = wtr_0.1 - wtr_2) |> 
  ggplot(aes(x = DateTime))+
  geom_point(aes(y = Dens_diff, color = "Dens"))+
  geom_point(aes(y = Temp_diff, color = "TempDiff"))+
  # geom_point(aes(y = wtr_0.1, color = "T 0.1"))+
  # geom_point(aes(y = wtr_2, color = "T 2"))+
  scale_x_datetime(date_breaks = "12 hour",  date_labels =  "%d (%H)") +
  labs(x = "Date (Hour) ")


# hobos_C2 |> 
#   filter(DateTime > ymd("2024-05-15"),
#          DateTime < ymd("2024-06-01")) |> 
#   mutate(Depth = paste0("wtr_", Depth)) |> 
#   pivot_wider(names_from = Depth, values_from = Temp_C) |> 
#   select(DateTime, wtr_0.1, wtr_2) |> 
#   mutate(wtr_0.1_dens = water.density(wtr_0.1),
#          wtr_2_dens = water.density(wtr_2),
#          Dens_diff = wtr_2_dens - wtr_0.1_dens,
#          Temp_diff = wtr_0.1 - wtr_2) |> 
#   ggplot(aes(x = DateTime))+
#   geom_point(aes(y = Dens_diff, color = "Dens"))+
#   # geom_point(aes(y = Temp_diff, color = "TempDiff"))+
#   # geom_point(aes(y = wtr_0.1, color = "T 0.1"))+
#   # geom_point(aes(y = wtr_2, color = "T 2"))+
#   scale_x_datetime(date_breaks = "2 days",  date_labels =  " %d %b") +
#   labs(x = "Date (Hour) ")



```



Plot data
```{r}
######P1 
#plot raw data
hobos_P1 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "P1")+
  # facet_wrap(~Depth)+
  theme_classic()

# hobos_P1 |> 
#   filter(DateTime >= ymd("2024-06-01")) |> 
#   ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
#   geom_line()+
#   geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
#   # facet_wrap(~Depth)+
#   theme_classic()
# 
# #plot daily data
# hobos_P1 |> 
#   mutate(Date = as.Date(DateTime)) |> 
#   group_by(Date, Depth) |> 
#   summarize(Temp_C = mean(Temp_C, na.rm = T)) |> 
#   ggplot(aes(x = Date, y = Temp_C, color = as.factor(Depth)))+
#   geom_line()+
#   geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
#   # facet_wrap(~Depth)+
#   theme_classic()

######P2
#plot raw data
hobos_P2 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "P2")+
  # facet_wrap(~Depth)+
  theme_classic()


######C2
#plot raw data
z <- hobos_C2 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "C2")+
  # facet_wrap(~Depth)+
  theme_classic()

plotly::ggplotly(z)



## C2 heatmap  
temp <- hobos_C2 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  filter(DateTime > ymd("2024-07-15")) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.1, 2, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - C2 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

## P2 heatmap  
temp <- hobos_P2 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  # filter(DateTime > ymd("2024-07-01")) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.1, 1.5, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - P2 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

## P1 heatmap  
temp <- hobos_P1 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.25, 0.75, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - P1 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

```



