---
title: "CCR spatial CTD and YSI measurements"
author: "Dexter Howard"
date: "2024-05-30"
output: html_document
---

## Read in packages 

```{r, include = F}
library(tidyverse)
# library(ggpubr)
# library(colorRamps) #for heatmap
# library(RColorBrewer) #for heatmap 
# library(rLakeAnalyzer)
# library(scales) #for date format on plots
# library(patchwork) #arrange figures w/ slashes and lines
# library(plotly)
# library(viridis)

```


## Temp/Cond across sites

Get YSI data 

```{r}
## YSI data
ysi_gsheet <- gsheet::gsheet2tbl("https://docs.google.com/spreadsheets/d/1MX__IelyQBHO1bNxAltfYT_r_pJisMuiMtDG4oxkOok/edit?gid=1922496606#gid=1922496606")

# ysi_L1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/YSI_PAR/ysi_L1.csv")

ccr_ysi <- ysi_gsheet |>
  filter(Reservoir == "CCR") |>
  mutate(Date = mdy_hm(DateTime)) |>
  mutate(Date = as.Date(Date)) |> 
  filter(year(Date) > 2023,
         !Date %in% c(ymd("2024-07-31"), ymd("2024-08-01")))

```


CTD cleaning function 

```{r}
###function to clean ctd casts
ccr_ctd_clean <- function(data){

  #slice by depth for each reservoir
    depths = seq(0.1, 23, by = 0.5)
    df.final<-data.frame()

 for (i in 1:length(depths)){
      
      fp_layer <- data %>% 
        mutate(Date = as.Date(DateTime)) |> 
        group_by(Date, Site) |>  
        slice(which.min(abs(as.numeric(Depth_m) - depths[i])))
      
      # Bind each of the data layers together.
      df.final = bind_rows(df.final, fp_layer)%>%
      mutate(Depth_m = round(Depth_m, digits = 1)) |> 
       dplyr::distinct() 
 }
    return(df.final)
}

```


Get CTD Data

```{r}

##read in EDI data (STAGED)
ctd_edi <- read_csv("https://pasta-s.lternet.edu/package/data/eml/edi/1113/14/bbd126d40b44abaeeb0d734009da9ae4" ) |> filter(Reservoir == "CCR")

### read in L data 
ctd_L1 <- read_csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/Raw_CTD/ctd_L1.csv")

ccr_ctd_24 <- plyr::rbind.fill(ctd_edi, ctd_L1) |> 
  mutate(Date = as.Date(DateTime)) |> 
  select(Reservoir, Site, Date, everything()) |> 
  filter(Reservoir == "CCR") 

ccr_ctd_24 <- ccr_ctd_clean(ccr_ctd_24)


```



## Bring CTD to YSI

```{r}
## grab distances and site class to bind in 
distances <- read.csv("C:/Users/dwh18/Downloads/2024 spatial sampling - Distances.csv") |> 
  mutate(Date = mdy(Date)) |> 
  select(-c(13,14)) |> 
  pivot_longer(-c(1,11,12), names_to = "Site_code", values_to = "Distance_ft")

site_class <- read.csv("C:/Users/dwh18/Downloads/2024 spatial sampling - Sites_Class.csv") |> 
  select(-X, -Key) |> 
  mutate(Date = mdy(Date)) |> 
  pivot_longer(-c(1), names_to = "Site_code", values_to = "Site_Class") |> 
  mutate(Site_Class = ifelse(Site_Class %in% c("S", "S "), "Stream", Site_Class),
         Site_Class = ifelse(Site_Class %in% c("P", "P "), "Pool", Site_Class),
         Site_Class = ifelse(Site_Class == "C", "Cove", Site_Class),
         Site_Class = ifelse(Site_Class == "L", "Pelagic", Site_Class))



##bind data together
ctd_bind <- ccr_ctd_24 |> 
  select(Reservoir, Site, Date, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
  filter(!Date %in% c(ymd("2024-07-31"), ymd("2024-08-01"), ymd("2024-08-15")))   #non EEM sample days
  # mutate(SpCond_uScm = ifelse(SpCond_uScm < 100, NA, SpCond_uScm)  ) # remove low values that aren't realistic

ysi_bind <- ccr_ysi |> 
  select(Reservoir, Site, Date, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
  filter(!Site %in% c(88,90))

sensors_nodistance <- rbind(ctd_bind, ysi_bind) |> 
  # mutate(Distance_ft = ifelse(Site == 101, 0, NA),
  #        Distance_ft = ifelse(Site == 100, 407, Distance_ft),
  #        Distance_ft = ifelse(Site == 98, 619, Distance_ft),
  #        Distance_ft = ifelse(Site == 96, 790, Distance_ft),
  #        Distance_ft = ifelse(Site == 94, 1015, Distance_ft),
  #        Distance_ft = ifelse(Site == 92, 1132, Distance_ft),
  #        Distance_ft = ifelse(Site == 90, 1843, Distance_ft),
  #        Distance_ft = ifelse(Site == 88, 3326, Distance_ft),
  #        Distance_ft = ifelse(Site == 50, 5011, Distance_ft)
  #        ) |> 
  mutate(Site_code = ifelse(Site == 101, "S1", NA),
         Site_code = ifelse(Site == 100, "S2", Site_code),
         Site_code = ifelse(Site == 98, "P1", Site_code),
         Site_code = ifelse(Site == 96, "P2", Site_code),
         Site_code = ifelse(Site == 94, "C1", Site_code),
         Site_code = ifelse(Site == 92, "C2", Site_code),
         Site_code = ifelse(Site == 90, "C3", Site_code),
         Site_code = ifelse(Site == 88, "C4", Site_code),
         Site_code = ifelse(Site == 50, "C50", Site_code)
         ) |> 
  select(Reservoir, Site, Site_code, Date, Depth_m, everything())


sensors <- left_join(sensors_nodistance, distances, by = c("Site_code", "Date")) |> 
    mutate(Distance = Distance_ft*0.3048,
         Dry_start = Dry_start*0.3048,
         Dry_end = Dry_end*0.3048) |> 
  filter(#Site != 50, #remove site 50 for EEMs comp
         Date > ymd("2024-04-23")) # remove S1 measurement from before sampling

sensors <- left_join(sensors, site_class, by = c("Site_code", "Date")) |> 
  select(Reservoir, Site, Site_code, Site_Class, Date, Distance, Dry_start, Dry_end, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm )


```



## Value on Y dot plots 

```{r}
## value is on y and color is depth

sensors |> 
  filter(Site_code != "C1") |> 
  select(-DO_mgL) |> 
  pivot_longer(-c(1:9)) |> 
  # filter(name == "Temp_C") |> 
  ggplot(aes(x = Distance, y = value, fill = Depth_m,
             shape = factor(Site_Class, levels = c("Stream", "Pool", "Cove", "Pelagic"))))+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.1, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  geom_point(size = 3)+
  theme_bw()+ theme(legend.position = "top", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  labs(x= "Distance from Stream (m)",
       shape = "Site Type")+
  scale_x_continuous(breaks = c(0, 500, 1000, 1500))+ #c(250, 750)
  scale_shape_manual(values = c(24, 22, 21, 25))+ #18, 15, 16, 17
  # scale_color_gradient(high = "red", low = "blue") +
  # scale_fill_gradient(high = "red", low = "blue") 
  scale_fill_gradient2(low = "red",  high ="blue",
                       midpoint = 6,  guide = "colourbar", breaks = c(3,6,9, 15, 20))

  #   scale_color_gradient2(low = "#E5E5E5", mid = "#7A7A7A", high ="#333333",
  #                      midpoint = 9,  guide = "colourbar", breaks = c(3,6,9, 15, 20))+
  # scale_fill_gradient2(low = "#E5E5E5", mid = "#7A7A7A", high ="#333333",
  #                      midpoint = 9,  guide = "colourbar", breaks = c(3,6,9, 15, 20))
  

  


```

Trial to focus on shallower sites 

```{r}

sensors |> 
  filter(Site_code != "C1") |> 
  filter(!Site %in% c(50,88,90)) |> 
  select(-DO_mgL) |> 
  pivot_longer(-c(1:9)) |> 
  # filter(name == "Temp_C") |> 
  ggplot(aes(x = Distance, y = value, fill = Depth_m,
             shape = factor(Site_Class, levels = c("Stream", "Pool", "Cove", "Pelagic"))))+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.1, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  geom_point(size = 3)+
  theme_bw()+ theme(legend.position = "top", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  labs(x= "Distance from Stream (m)",
       shape = "Site Type")+
  scale_x_continuous(breaks = c(0, 150, 300))+ #c(250, 750)
  scale_shape_manual(values = c(24, 22, 21, 25))+ #18, 15, 16, 17
  scale_fill_gradient2(low = "red",  high ="blue",
                       midpoint = 0.7,  guide = "colourbar", breaks = c(0,1,2,3))


```



## Depth on Y dot plots - old style

Distance on x 

```{r}
#facet grid 
sensors |> 
  filter(Site_code != "C1") |> 
  select(-DO_mgL) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, fill = value))+
  geom_point(size = 2)+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.01, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "top", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  labs(x= "Distance from Stream (m)",
       shape = "Site Type")+
  scale_x_continuous(breaks = c(0, 500, 1000, 1500))


#one plot at a time 
sensors |> 
  select(1:9, Temp_C) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.1, fill = "gray", color = NA )+ #color gets rid of border
  geom_point(size = 3)+
  scale_y_reverse()+
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  labs(x= "Distance from Stream (m)",
       shape = "Site Type")+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"


##raster 
sensors |> 
  select(1:9, Temp_C) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, fill = value))+
  geom_raster()+
  scale_y_reverse()+
  # geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
  #           alpha = 0.01, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_fill_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

#trying  https://dewey.dunnington.ca/post/2019/depth-time-heatmaps/

estimate_temp_by_site <- function(target_date, target_site, target_depth) {
  data_for_date <- sensors %>% 
    filter(Date == target_date,
           Site == target_site) %>%
    arrange(Depth_m)
  
  # approx() is one way to do a linear interpolation
  approx(data_for_date$Depth_m, data_for_date$Temp_C, xout = target_depth)$y
}

estimate_temp_by_site(ymd("2024-05-22"), 90, c(0, 1, 1.5, 2))

temp_interp_depth <- crossing(
  tibble(Date = unique(sensors$Date)),
  tibble(Site = unique(sensors$Site)),
  # depths can now be any value
  tibble(Depth_m = seq(0.1, max(sensors$Depth_m), length.out = 100))
) %>%
  group_by(Date) %>%
  mutate(Temp_C = estimate_temp_by_site(Date[1], Site[1], Depth_m))


```



Chat gpt trial

```{r}

# ##chat gpt trial
# df_grouped <- sensors |> 
#   group_by(Date, Site) 
# 
# # Create a function for linear interpolation across Depths
# interpolate_depth <- function(data) {
#   approx(data$Depth_m, data$Temp_C, xout = seq(min(data$Depth_m), max(data$Depth_m), by = 0.1))
# }
# 
# 
# 
# # Apply the interpolation function for each group
# df_interpolated_depth <- df_grouped %>%
#   do(data.frame(Depth_m = seq(min(Depth_m), max(Depth_m), by = 0.1),
#                 Temp_C = interpolate_depth(Temp_C)))

  

#fresh chapgtp 
df_grouped <- sensors |> 
  select(Site, Date, Depth_m, Temp_C) |> 
  filter(Site < 100) |> 
  group_by(Date, Site) |> 
  nest()

interpolate_depth <- function(df) {
  if (nrow(df) < 2) {
    # If there's only one depth measurement, return the original data
    return(df)
  } else {
    depth_seq <- seq(min(df$Depth_m, na.rm = TRUE), max(df$Depth_m, na.rm = TRUE), by = 0.1)
    temp_interp <- approx(df$Depth_m, df$Temp_C, xout = depth_seq, method = "linear", rule = 2)$y  ## add rule = 1 or 2; 1 will make NAs for values outside of df 
    data.frame(Depth_m = depth_seq, Temp_C = temp_interp)
  }
}

df_interpolated <- df_grouped %>%
  mutate(data = map(data, interpolate_depth)) %>%
  unnest(data)

#check of interp
df_interpolated |> 
  ggplot(aes(x = Site, y = Depth_m, color = Temp_C))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

## Now interpolate across distance
df_next <- df_interpolated |> 
  mutate(Site_code = ifelse(Site == 101, "S1", NA),
         Site_code = ifelse(Site == 100, "S2", Site_code),
         Site_code = ifelse(Site == 98, "P1", Site_code),
         Site_code = ifelse(Site == 96, "P2", Site_code),
         Site_code = ifelse(Site == 94, "C1", Site_code),
         Site_code = ifelse(Site == 92, "C2", Site_code),
         Site_code = ifelse(Site == 90, "C3", Site_code),
         Site_code = ifelse(Site == 88, "C4", Site_code),
         Site_code = ifelse(Site == 50, "C50", Site_code)
         ) |> 
  left_join(distances, by = c("Site_code", "Date")) |> 
    mutate(Distance = Distance_ft*0.3048,
         Dry_start = Dry_start*0.3048,
         Dry_end = Dry_end*0.3048) |>  
  select(Site, Date, Depth_m, Distance, Temp_C)

#code to interp
df_interpolated_across_distances <- df_next %>%
  group_by(Date, Depth_m) %>%
  nest()

interpolate_distance <- function(df) {
  if (nrow(df) < 2) {
    # If there's only one distance measurement, return the original data
    return(df)
  } else {
    distance_seq <- seq(min(df$Distance, na.rm = TRUE), max(df$Distance, na.rm = TRUE), by = 1)
    temp_interp <- approx(df$Distance, df$Temp_C, xout = distance_seq, method = "linear")$y
    data.frame(Distance = distance_seq, Temp_C = temp_interp)
  }
}



df_interpolated_across_distances <- df_interpolated_across_distances %>%
  mutate(data = map(data, interpolate_distance)) %>%
  unnest(data)

#check out the interp
df_interpolated_across_distances |> 
  ggplot(aes(x = Distance, y = Depth_m, color = Temp_C))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"


## add S1 and S2 back 
streamtemp <- sensors |> 
  filter(Site %in% c(100,101)) |> 
  select(Date, Depth_m, Distance, Temp_C, Site)


rbind(streamtemp, df_interpolated_across_distances) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = Temp_C))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18),
                    panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"
  



```








```{r}
#value on Y
tempplot <- sensors |> 
  select(1:9, Temp_C) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.01, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "red", low = "blue") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

condplot <- sensors |> 
  select(1:9, SpCond_uScm) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.01, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x=element_blank())+
  scale_color_gradient(high = "black", low = "#CFCFCF") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

doplot <- sensors |> 
  select(1:9, DOsat_percent) |> 
  pivot_longer(-c(1:9)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  geom_rect(aes(xmin = Dry_start, xmax = Dry_end, ymin = -Inf, ymax = Inf), 
            alpha = 0.01, fill = "gray", color = NA )+ #color gets rid of border
  facet_grid(name~Date, scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "blue", low = "red") # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"

ggarrange(tempplot , condplot , doplot, ncol = 1)

```





## Heatmaps 

```{r}

fp_new <- sensors |> 
  filter(Date == ymd("2024-08-14")) |>  
   filter(Site < 101)



  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C, duplicate = "strip")


#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = (Distance), y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ #to mark cast sites 
    scale_fill_gradientn(colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Temp CCR 22may24")+
    theme_bw()
  
  
#Cond
#   interp_spcond <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
#                    xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
#                    yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.5),
#                    extrap = T, linear = T, duplicate = "strip")
#   interp_spcond <- akima::interp2xyz(interp_spcond, data.frame=T)
#   
#   # max_depths <- fp_new |> 
#   #   group_by(Site, Distance) |> 
#   #   summarise(max_depth = max(Depth_m))
#   
#   # interp_spcond_v2 <- interp_spcond |> 
#   #   mutate(x_2 = ifelse(x < ))
#   
# ggplot(interp_spcond, aes(x=x, y=y))+
#     geom_raster(aes(fill=z))+
#     scale_y_reverse(expand = c(0,0))+
#     scale_x_continuous(expand = c(0, 0)) +
#     # geom_point(data = sensor_22may24, aes(x = (Distance_ft*0.3048), y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ #to mark cast sites ; (sensor_22may24 |> filter(!Site ==50))
#     scale_fill_gradientn(colours = colorRamps::blue2green2red(60), na.value="gray")+
#     labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Sp.Cond CCR 22may24")+
#     theme_bw()
# 
# fp_new
# ggplot(fp_new, aes(x = Distance, y = Depth_m)) +
#   geom_contour_filled(aes(z = Temp_C), bins = 5) +
#   scale_fill_brewer(palette = "Spectral") +
#   labs(x = "distance", y = "Depth (m)", fill = "Temperature (Â°C)") +
#   theme_minimal() + 
#   scale_y_reverse()


```


## CCR ADCP plots 

```{r}
#all sites
ccr_ctd_24 |> 
  filter(Date == ymd("2024-08-15")) |> 
  filter(Turbidity_NTU < 50) |> 
  select(Site, Depth_m, Temp_C, DOsat_percent, SpCond_uScm, Chla_ugL, Turbidity_NTU, CDOM_ugL) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = value, y = Depth_m))+
  geom_line(orientation = "y")+  scale_y_reverse()+
  facet_grid(Site~name, scales = "free")+  theme_bw()+ theme(text = element_text(size = 18))

#C3
ccr_ctd_24 |> 
  filter(Date == ymd("2024-08-15"), Site == 90) |> 
  filter(Turbidity_NTU < 50) |> 
  select(Site, Depth_m, Temp_C, SpCond_uScm, Turbidity_NTU, CDOM_ugL) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = value, y = Depth_m))+
  geom_line(orientation = "y")+  scale_y_reverse()+
  facet_grid(Site~name, scales = "free")+  theme_bw()+ theme(text = element_text(size = 18))


```


## CCR MSN Plots 

Get data 
```{r}
#YSI 
## midnight time for Site 90 has become the wrong day in L1 file
ysi_L1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/YSI_PAR/ysi_L1.csv")

ccr_ysi_MSN <- ysi_L1 |>
  filter(Reservoir == "CCR") |>
  mutate(Date = as.Date(DateTime)) |>
  filter(year(Date) > 2023,
         Date %in% c(ymd("2024-07-31"), ymd("2024-08-01"))) |> 
  mutate(DateTime = ymd_hms(DateTime)) |> 
  filter(Site %in% c(90,92)) |> 
  mutate(sensor = "YSI") |> 
  select(Site, DateTime, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm, sensor) 


#CTD
ctd_L1 <- read_csv("https://raw.githubusercontent.com/CareyLabVT/Reservoirs/master/Data/DataNotYetUploadedToEDI/Raw_CTD/ctd_L1.csv")

ccr_ctd_clean_MSN <- function(data){

  #slice by depth for each reservoir
    depths = seq(0.1, 23, by = 0.1)
    df.final<-data.frame()

 for (i in 1:length(depths)){
      
      fp_layer <- data %>% 
        # mutate(Date = as.Date(DateTime)) |> 
        group_by(DateTime, Site) |>  
        slice(which.min(abs(as.numeric(Depth_m) - depths[i])))
      
      # Bind each of the data layers together.
      df.final = bind_rows(df.final, fp_layer)%>%
      mutate(Depth_m = round(Depth_m, digits = 1)) |> 
       dplyr::distinct() 
 }
    return(df.final)
}

ccr_ctd_MSN <- ctd_L1 |>
  filter(Reservoir == "CCR") |>
  mutate(Date = as.Date(DateTime)) |>
  filter(Date %in% c(ymd("2024-07-31"), ymd("2024-08-01")))  

ccr_ctd_MSN <- ccr_ctd_clean_MSN(ccr_ctd_MSN) |> 
    select(Site, DateTime, Depth_m, Temp_C, DO_mgL, DOsat_percent, SpCond_uScm) |> 
    mutate(sensor = "CTD")  

##full ctd check
ccr_ctd_MSN |> 
  ggplot(aes(x = Temp_C, y = Depth_m, color = as.factor(DateTime))) + 
  geom_line(orientation = 'y', size = 1.2)+
  scale_y_reverse()+
  facet_wrap(~Site, scales = "free")



## Put data together
ccr_MSN_profiles <- rbind(ccr_ysi_MSN, ccr_ctd_MSN)


```


Plotting 
```{r}
####### Get data together 

ccr_MSN_grouped <- ccr_MSN_profiles |> 
  mutate(DateTime = ymd_hms(DateTime),
         Hour = hour(DateTime),
         Date = as.Date(DateTime)) |> 
    # mutate(Hour_group = ifelse(Hour %in% c(23,0), 0, NA),
  #        Hour_group = ifelse(Hour %in% c(12,13), 12, Hour_group),
  #        Hour_group = ifelse(Hour %in% c(20,21), 8, Hour_group),
  #        Hour_group = ifelse(Hour %in% c(6), 6, Hour_group)
  #        ) |> 
  #mutate(DateTime_fixed = ifelse(Date == ymd("2024-07-31") & Hour_group == 0, DateTime + 1000, DateTime) ) |> 
  #mutate(DateTime_fixed = as.POSIXct(DateTime_fixed, tz = "UTC")) |>  #this and previous mutate: manually force times  right before midnight to shift past midnight for faceting
  ## mutate(SunTime = ifelse(Hour %in% c(23,0), "Midnight", NA),
  ##        SunTime = ifelse(Hour %in% c(12,13), "Noon", SunTime),
  ##       SunTime = ifelse(Hour %in% c(20,21), "Sunset", SunTime),
  ##        SunTime = ifelse(Hour %in% c(6), "Sunrise", SunTime)
  ##        ) |>
  mutate(SunTime = ifelse(DateTime > ymd_hm("2024-07-31 12:00") & DateTime < ymd_hm("2024-07-31 14:00") , 
                          "Noon 1", NA),
         SunTime = ifelse(DateTime > ymd_hm("2024-07-31 20:00") & DateTime < ymd_hm("2024-07-31 22:00") , 
                          "Sunset", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-07-31 23:00") & DateTime < ymd_hm("2024-08-01 2:00") , 
                          "Midnight", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-08-01 6:00") & DateTime < ymd_hm("2024-08-01 8:00") , 
                          "Sunrise", SunTime),
         SunTime = ifelse(DateTime > ymd_hm("2024-08-01 12:00") & DateTime < ymd_hm("2024-08-01 14:00") , 
                          "Noon 2", SunTime)
         ) |>
  filter(!(sensor == "YSI" & Site == 90)) |>
  # mutate(DateTime_new = ymd_h(paste(as.Date(DateTime_fixed), Hour_group, sep = " "))) |> 
  mutate(Distance_ft = ifelse(Site == 92, 1132, NA),
         Distance_ft = ifelse(Site == 90, 1843, Distance_ft),
         Distance_ft = ifelse(Site == 88, 3326, Distance_ft),
         Distance = Distance_ft*0.3048) 
  

####### site 92 
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 92) |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C2")


####### site 90
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 90,
         sensor == "CTD") |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C3")

# ccr_MSN_grouped |> 
#   select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
#   filter(Site == 90,
#          sensor == "YSI") |> 
#   pivot_longer(-c(1:4)) |> 
#   ggplot(aes(x = value, y = Depth_m, color = SunTime))+
#   facet_wrap(~name, scales = "free_x")+
#   geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
#   scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C3")


####### site 88
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C, DOsat_percent, SpCond_uScm) |> 
  filter(Site == 88) |> 
  pivot_longer(-c(1:4)) |> 
  ggplot(aes(x = value, y = Depth_m, color = SunTime))+
  facet_wrap(~name, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18))+ labs(title = "C4")
 


###### all sites 

time_levels <- c("Noon 1", "Sunset", "Midnight", "Sunrise", "Noon 2")

### flipping so value is on y and color is depth
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  ggplot(aes(x = Distance, y = value, color = Depth_m))+
  geom_point()+
  facet_grid(name~factor(SunTime, levels = time_levels), scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "blue", low = "red") 

#depth on y 
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  ggplot(aes(x = Distance, y = Depth_m, color = value))+
  geom_point()+
  scale_y_reverse()+
  facet_grid(name~factor(SunTime, levels = time_levels), scales = "free_y")+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))+
  labs(x= "Distance (m)")+
  scale_color_gradient(high = "black", low = "#CFCFCF")  # high = "black", low = "#CFCFCF"  ;  high = "red", low = "blue"


## Lines instead of heatmpas
ccr_MSN_grouped |> 
  select(Site, DateTime, SunTime, Distance, Depth_m, Temp_C) |> 
  pivot_longer(-c(1:5)) |> 
  filter(Site == 90 ) |> 
  ggplot(aes(x = DateTime, y = value, color = as.factor(Depth_m)))+
  geom_point()+
  geom_line()+
  # facet_wrap(~Site, scales = "free_y", ncol =1 )+
  theme_bw()+ theme(legend.position = "right", text = element_text(size = 18))


#other 
ccr_MSN_grouped |> 
  select(Site, SunTime, sensor, Depth_m, Temp_C) |> 
  #filter( SunTime == "Sunrise") |> 
  ggplot(aes(x = Temp_C, y = Depth_m))+
  facet_grid(factor(SunTime, levels = time_levels)~Site, scales = "free_x")+
  geom_line(orientation = "y", size = 1)+  geom_point(size = 2)+
  scale_y_reverse()+  theme_bw() + theme(text = element_text(size = 18), legend.position = "top")



```

Density Diffs 

```{r}
ccr_MSN_grouped

time_levels <- c("Noon 1", "Sunset", "Midnight", "Sunrise", "Noon 2")


dens_diff_data <- ccr_MSN_grouped |> 
  select(Site, SunTime, Depth_m, Temp_C) |> 
  group_by(Site, SunTime) |> 
  mutate(top_depth = min(Depth_m),
         bot_depth = max(Depth_m)) |> 
  mutate(wtr_top = ifelse(Depth_m == top_depth, Temp_C, NA),
         wtr_top = max(wtr_top, na.rm = T),
         wtr_bot = ifelse(Depth_m == bot_depth, Temp_C, NA),
         wtr_bot = max(wtr_bot, na.rm = T)) |> 
  mutate(temp_diff = wtr_top - wtr_bot,
            dens_diff = water.density(wtr_bot) - water.density(wtr_top)) |> 
  select(Site, SunTime, wtr_top, wtr_bot, temp_diff, dens_diff) |> 
  distinct()

dens_diff_data |> 
  select(Site, SunTime, temp_diff, dens_diff) |> 
  pivot_longer(-c(1:2)) |> 
  ggplot(aes(x = factor(SunTime, levels = time_levels), y = value))+
  geom_point()+
  geom_hline(yintercept = 0)+
  geom_hline(yintercept = 0.1)+
  geom_hline(yintercept = 1)+
  facet_grid(name~Site, scales = "free_y")+
  labs(x = element_blank())+
  theme_bw() + theme(text = element_text(size = 18), axis.text.x = element_text(angle = 45, vjust = 0.5))




```

Heatmaps Time 

```{r}
#### C4
fp_new <- ccr_MSN_grouped |> 
  filter(Site == 88) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$DateTime), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$DateTime), max(fp_new$DateTime), by = 5000),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)
  interp_temp$DateTime <- as.POSIXct(interp_temp$x, tz = "UTC")

ggplot(interp_temp, aes(x=DateTime, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    geom_point(data = fp_new, aes(x = DateTime, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR C4")+
    theme_bw()


#### C3
fp_new <- ccr_MSN_grouped |> 
  filter(Site == 90) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$DateTime), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$DateTime), max(fp_new$DateTime), by = 5000),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m)*2, by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)
  interp_temp$DateTime <- as.POSIXct(interp_temp$x, tz = "UTC")

ggplot(interp_temp, aes(x=DateTime, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    geom_point(data = fp_new, aes(x = DateTime, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR C3")+
    theme_bw()





```

Heatmaps Distance

```{r}

#### Noon 1
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 1') 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon1 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Noon")+
    theme_bw()


#### Sunset
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunset') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunset <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Sunset")+
    theme_bw()

#### Midnight
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Midnight') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

midnight <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 1Aug - Midnight")+
    theme_bw()

#### Sunrise
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunrise') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunrise <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 1Aug - Sunrise")+
    theme_bw()

#### Noon 2
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 2') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$Temp_C,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),
                   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),
                   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon2 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(10,30), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "Temp CCR 1Aug - Noon")+
    theme_bw()


### plots 
noon1
sunset
midnight
sunrise
noon2

library(patchwork)
noon1/sunset/midnight/sunrise/noon2


```

Cond heatmaps 

```{r}
#### Noon 1
fp_new <- ccr_MSN_grouped |>   filter(SunTime == 'Noon 1', !is.na(SpCond_uScm)) 

#Temp
  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10), yo = seq(min(fp_new$Depth_m),max(fp_new$Depth_m), by = 0.1), extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon1 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+
    scale_y_reverse(expand = c(0,0))+
    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130) , colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = element_blank(), y = "Depth (m)", title = "Temp CCR 31July - Noon")+
    theme_bw()


#### Sunset
fp_new <- ccr_MSN_grouped |>   filter(SunTime == 'Sunset') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1), extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunset <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+ scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 31July - Sunset")+
    theme_bw()

#### Midnight
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Midnight') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),         extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

midnight <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Midnight")+
    theme_bw()

#### Sunrise
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Sunrise') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),  yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),   extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

sunrise <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Sunrise")+
    theme_bw()

#### Noon 2
fp_new <- ccr_MSN_grouped |> 
  filter(SunTime == 'Noon 2') 

  interp_temp <- akima::interp(x=as.numeric(fp_new$Distance), y = fp_new$Depth_m, z = fp_new$SpCond_uScm,
                   xo = seq(min(fp_new$Distance), max(fp_new$Distance), by = 10),   yo = seq(min(fp_new$Depth_m), max(fp_new$Depth_m), by = 0.1),                 extrap = T, linear = T, duplicate = "strip")
  interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

noon2 <- ggplot(interp_temp, aes(x=x, y=y))+
    geom_raster(aes(fill=z))+    scale_y_reverse(expand = c(0,0))+    scale_x_continuous(expand = c(0, 0)) +
    geom_point(data = fp_new, aes(x = Distance, y = 0.1, z = NULL), pch = 25, size = 3, fill = "black")+ 
    scale_fill_gradientn(limits = c(108,130), colours = colorRamps::blue2green2red(60), na.value="gray")+
    labs(x = "Distance from Stream (m)", y = "Depth (m)", title = "SpCond CCR 1Aug - Noon")+
    theme_bw()


### plots 
noon1
sunset
midnight
sunrise
noon2

library(patchwork)
noon1/sunset/midnight/sunrise/noon2

```





## Pool and Cove HOBO buoys THROUGH OCTOBER 


P1:  April - October
```{r}
hobo_P1_top <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo101_P1_bot3_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.25)

hobo_P1_mid <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo51_P1_bot2_28oct24.csv", skip = 1) |> 
    select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.5)

#3rd hobo couldn't connect

hobos_P1 <- rbind(hobo_P1_top, hobo_P1_mid) |> 
  mutate(DateTime = mdy_hms(DateTime))


```


C2 April - October 

```{r}
hobo_C2_b6 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo10_C2_bot6_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.75)

hobo_C2_b3 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo19_C2_bot3_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.5)

hobo_C2_b5 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo31_C2_bot5_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1)

hobo_C2_b1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo39_C2_bot1_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 2)

hobo_C2_b9 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo63_C2_bot9_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.1)

hobo_C2_b4 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo68_C2_bot4_28oct24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.25)

#hobos bot2,7,8 couldnt connect

hobos_C2 <- rbind(hobo_C2_b1, hobo_C2_b3, hobo_C2_b4, hobo_C2_b5, 
                  hobo_C2_b6, hobo_C2_b9) |> 
  mutate(DateTime = mdy_hms(DateTime))

```


Plot data

```{r}
######P1 
#plot raw data
hobos_P1 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "P1")+
  # facet_wrap(~Depth)+
  theme_classic()

# #plot daily data
# hobos_P1 |> 
#   mutate(Date = as.Date(DateTime)) |> 
#   group_by(Date, Depth) |> 
#   summarize(Temp_C = mean(Temp_C, na.rm = T)) |> 
#   ggplot(aes(x = Date, y = Temp_C, color = as.factor(Depth)))+
#   geom_line()+
#   geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
#   # facet_wrap(~Depth)+
#   theme_classic()



######C2
#plot raw data
z <- hobos_C2 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "C2")+
  # facet_wrap(~Depth)+
  theme_classic()

plotly::ggplotly(z)



## C2 heatmap  
temp <- hobos_C2 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  # filter(DateTime > ymd("2024-07-15")) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.1, 2, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - C2 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()


## P1 heatmap  
temp <- hobos_P1 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.25, 0.75, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - P1 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()


## C2 density diff
hobos_C2 |> 
  mutate(Depth = paste0("wtr_", Depth)) |> 
  pivot_wider(names_from = Depth, values_from = Temp_C) |> 
  select(DateTime, wtr_0.1, wtr_2) |> 
  mutate(wtr_0.1_dens = water.density(wtr_0.1),
         wtr_2_dens = water.density(wtr_2),
         Dens_diff = wtr_2_dens - wtr_0.1_dens,
         Temp_diff = wtr_0.1 - wtr_2) |> 
  ggplot(aes(x = DateTime))+
  geom_point(aes(y = Dens_diff, color = "Dens"))+
  geom_point(aes(y = Temp_diff, color = "TempDiff"))+
  # geom_point(aes(y = wtr_0.1, color = "T 0.1"))+
  # geom_point(aes(y = wtr_2, color = "T 2"))+
  scale_x_datetime(date_breaks = "1 month") +
  #scale_x_datetime(date_breaks = "12 hour",  date_labels =  "%d (%H)") +
  labs(x = "Date (Hour) ")

```









## Pool and Cove HOBO buoys THROUGH July

P1 
get data together from April - July 11
```{r}
hobo_P1_top <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo101_P1_top_11jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.25)

hobo_P1_mid <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo51_P1_mid_11jul24.csv", skip = 1) |> 
    select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.5)


hobo_P1_bot <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P1_2024/hobo36_P1_bot_11jul24.csv", skip = 1) |> 
    select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P1", Depth = 0.75)


hobos_P1 <- rbind(hobo_P1_top, hobo_P1_mid, hobo_P1_bot) |> 
  mutate(DateTime = mdy_hms(DateTime))


```


P2
get data together from April - July 19
```{r}
hobo_P2_b1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo23_P2_BOT1_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1.5)

hobo_P2_b2 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo40_P2_bot2_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1.25)

hobo_P2_b3 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo44_P2_bot3_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 1)

hobo_P2_b4 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo2_P2_bot4_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.75)

hobo_P2_b5 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo9_p2_bot5_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.5)

hobo_P2_b7 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/P2_2024/hobo16_p2_bot7_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "P2", Depth = 0.1)

hobos_P2 <- rbind(hobo_P2_b1, hobo_P2_b2, hobo_P2_b3, hobo_P2_b4, hobo_P2_b5, hobo_P2_b7) |> 
  mutate(DateTime = mdy_hms(DateTime))


```


C2
get data together from April - July 19
```{r}
hobo_C2_b6 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo10_C2_bot6_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.75)

hobo_C2_b7 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo13_C2_bot7_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.5)

hobo_C2_b2 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo168_C2_BOt2_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.75)

hobo_C2_b3 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo19_C2_BOt3_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.5)

hobo_C2_b8 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo30_C2_bot8_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.25)

hobo_C2_b5 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo31_C2_bot5_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1)

hobo_C2_b1 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo39_C2_BOT1_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 2)

hobo_C2_b9 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo63_C2_bot9_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 0.1)

hobo_C2_b4 <- read.csv("https://raw.githubusercontent.com/CareyLabVT/ManualDownloadsSCCData/master/CCR_manual_downloads/CCR_Hobos/Cove_Pool_buoys/C2_2024/hobo68_C2_BOt4_19jul24.csv", skip = 1) |> 
  select(2:3) |> rename(DateTime = 1, Temp_C = 2) |> mutate(Site = "C2", Depth = 1.25)


hobos_C2 <- rbind(hobo_C2_b1, hobo_C2_b2, hobo_C2_b3, hobo_C2_b4, hobo_C2_b5, 
                  hobo_C2_b6, hobo_C2_b7, hobo_C2_b8, hobo_C2_b9) |> 
  mutate(DateTime = mdy_hms(DateTime))

```


Density difference plots 

```{r}
head(hobos_C2)

## July subset
hobos_C2 |> 
  filter(DateTime > ymd("2024-07-15")) |> 
  mutate(Depth = paste0("wtr_", Depth)) |> 
  pivot_wider(names_from = Depth, values_from = Temp_C) |> 
  select(DateTime, wtr_0.1, wtr_2) |> 
  mutate(wtr_0.1_dens = water.density(wtr_0.1),
         wtr_2_dens = water.density(wtr_2),
         Dens_diff = wtr_2_dens - wtr_0.1_dens,
         Temp_diff = wtr_0.1 - wtr_2) |> 
  ggplot(aes(x = DateTime))+
  geom_point(aes(y = Dens_diff, color = "Dens"))+
  geom_point(aes(y = Temp_diff, color = "TempDiff"))+
  # geom_point(aes(y = wtr_0.1, color = "T 0.1"))+
  # geom_point(aes(y = wtr_2, color = "T 2"))+
  scale_x_datetime(date_breaks = "12 hour",  date_labels =  "%d (%H)") +
  labs(x = "Date (Hour) ")


# hobos_C2 |> 
#   filter(DateTime > ymd("2024-05-15"),
#          DateTime < ymd("2024-06-01")) |> 
#   mutate(Depth = paste0("wtr_", Depth)) |> 
#   pivot_wider(names_from = Depth, values_from = Temp_C) |> 
#   select(DateTime, wtr_0.1, wtr_2) |> 
#   mutate(wtr_0.1_dens = water.density(wtr_0.1),
#          wtr_2_dens = water.density(wtr_2),
#          Dens_diff = wtr_2_dens - wtr_0.1_dens,
#          Temp_diff = wtr_0.1 - wtr_2) |> 
#   ggplot(aes(x = DateTime))+
#   geom_point(aes(y = Dens_diff, color = "Dens"))+
#   # geom_point(aes(y = Temp_diff, color = "TempDiff"))+
#   # geom_point(aes(y = wtr_0.1, color = "T 0.1"))+
#   # geom_point(aes(y = wtr_2, color = "T 2"))+
#   scale_x_datetime(date_breaks = "2 days",  date_labels =  " %d %b") +
#   labs(x = "Date (Hour) ")



```



Plot data
```{r}
######P1 
#plot raw data
hobos_P1 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "P1")+
  # facet_wrap(~Depth)+
  theme_classic()

# hobos_P1 |> 
#   filter(DateTime >= ymd("2024-06-01")) |> 
#   ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
#   geom_line()+
#   geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
#   # facet_wrap(~Depth)+
#   theme_classic()
# 
# #plot daily data
# hobos_P1 |> 
#   mutate(Date = as.Date(DateTime)) |> 
#   group_by(Date, Depth) |> 
#   summarize(Temp_C = mean(Temp_C, na.rm = T)) |> 
#   ggplot(aes(x = Date, y = Temp_C, color = as.factor(Depth)))+
#   geom_line()+
#   geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
#   geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
#   # facet_wrap(~Depth)+
#   theme_classic()

######P2
#plot raw data
hobos_P2 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "P2")+
  # facet_wrap(~Depth)+
  theme_classic()


######C2
#plot raw data
z <- hobos_C2 |> 
  ggplot(aes(x = DateTime, y = Temp_C, color = as.factor(Depth)))+
  geom_line()+
  geom_vline(xintercept = ymd_hms("2024-05-22 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-06-19 00:00:00"))+
  geom_vline(xintercept = ymd_hms("2024-07-11 00:00:00"))+
  labs(title = "C2")+
  # facet_wrap(~Depth)+
  theme_classic()

plotly::ggplotly(z)



## C2 heatmap  
temp <- hobos_C2 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  filter(DateTime > ymd("2024-07-15")) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.1, 2, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - C2 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

## P2 heatmap  
temp <- hobos_P2 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  # filter(DateTime > ymd("2024-07-01")) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.1, 1.5, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - P2 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

## P1 heatmap  
temp <- hobos_P1 |> 
  mutate(DateTime_hourly = ymd_hms(paste(as.Date(DateTime), hour(DateTime), ":00:00"))
         ) |> 
  group_by(DateTime_hourly, Depth) |> 
  summarise(Temp_C = mean(Temp_C, na.rm = T))  |> 
  rename(DateTime = DateTime_hourly)
  # pivot_wider(names_from = Depth, values_from = Temp_C)



interp_temp <- akima::interp(x=temp$DateTime, y = temp$Depth, z = temp$Temp_C,  #x was DOY
                       xo = seq(min(temp$DateTime), max(temp$DateTime), by = "1 hour"), 
                      yo = seq(0.25, 0.75, by = 0.1),                     #second seq value was 10.2
                      extrap = F, linear = T, duplicate = "strip")
interp_temp <- akima::interp2xyz(interp_temp, data.frame=T)

ggplot(interp_temp, aes(x= as.POSIXct(x, origin = "1970-01-01"), y=y))+
  geom_raster(aes(fill=z))+
  scale_y_reverse()+
  scale_fill_gradientn(colours = blue2green2red(60), na.value="gray")+
  labs(x = "Date", y = "Depth (m)", title = "CCR - P1 Heatmap",fill=expression(''*~degree*C*''))+
  theme_classic()

```





